!function(t) {
    "use strict";
    var n = function(n) {
        return this.each(function() {
            var e, a, I = t(this), o = I.data(), r = [I], c = this.tagName, d = 0;
            e = t.extend({content: "body", headings: "h1,h2,h3"}, {content: o.toc || void 0, headings: o.tocHeadings || void 0}, n),
                a = e.headings.split(","),
                t(e.content).find(e.headings).attr("id", function(n, e) {
                    return e || function(t) {
                        if (0 === t.length) t = "?";
                        var n = t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim().replace(/[^a-z0-9 ]/g, "").replace(/\s+/g, "-"),
                            e = "", a = 1;
                        while (null !== document.getElementById(n + e)) e = "_" + a++;
                        return n + e;
                    }(t(this).text());
                }).each(function() {
                    var n = t(this), e = t.map(a, function(t, e) { return n.is(t) ? e : void 0; })[0];
                    if (e > d) {
                        var i = r[0].children("li:last")[0];
                        i && r.unshift(t("<" + c + "/>").appendTo(i));
                    } else r.splice(0, Math.min(d - e, Math.max(r.length - 1, 0)));
                    n.text() && t("<li/>").appendTo(r[0]).append(t("<a/>").text(n.text()).attr("href", "#" + n.attr("id")).attr("data-scrollto", "#" + n.attr("id")).addClass("nav-link")),
                        d = e;
                });
        });
    }, e = t.fn.toc;
    t.fn.toc = n,
        t.fn.toc.noConflict = function() {
            return t.fn.toc = e, this;
        },
        t(function() {
            n.call(t("[data-toc]"));
        });
}(window.jQuery);

$(document).ready(function() {
    var offset = 120;

    function getElementPositionFromTop(element) {
        var rect = element.getBoundingClientRect();
        var scrollTop = window.scrollY || window.pageYOffset;
        return rect.top + scrollTop;
    }

    function updateActiveLink() {
        var scrollPos = $(window).scrollTop() + offset;
        var currentLink = null;

        $('ul.toc-list a[data-scrollto]').each(function() {
            var refElement = $($(this).attr("data-scrollto"));
            if (refElement.position().top <= scrollPos) {
                currentLink = $(this);
            }
        });

        if (currentLink) {
            $('ul.toc-list a[data-scrollto]').removeClass("active");
            currentLink.addClass("active");
        } else {
            $('ul.toc-list a[data-scrollto]').removeClass("active");
        }
    }

    if (window.location.hash) {
        var o = window.location.hash;
        if ($(o).length && !$('a[href="' + o + '"]').attr('role')) {
            $('html, body').animate({
                scrollTop: $(o).offset().top - offset
            }, 500, 'swing');
        }
    }

    $(window).on("scroll", function() {
        updateActiveLink();
    });

    // Gérer les clics sur les liens dans UL.toc-list uniquement
    $('ul.toc-list a[data-scrollto]').click(function(e) {
        e.preventDefault();
        var target = $(this).attr('data-scrollto');
        if ($(target).length) {
            $('html, body').animate({
                scrollTop: $(target).offset().top - offset
            }, 500, 'swing', function() {
                // Ajouter l'ID dans l'URL après l'animation
                history.pushState(null, null, target);
            });
        }
    });

    updateActiveLink(); // Initial call to set the active link on page load
});
